<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Near â€” Real people</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- HERO -->
  <main id="hero" class="hero">
    <!-- Top badges -->
    <div class="heroTop">
      <div class="brandPill">
        <div class="brandName">N E A R</div>
        <div class="brandTag">nearest &amp; dearest</div>
      </div>

      <div class="statusPill" id="statusPill">
        <span class="dot" id="locDot" aria-hidden="true"></span>
        <span id="statusBadge">Vibe: nature â€¢ Location off</span>
      </div>
    </div>

    <!-- Title -->
    <section class="heroCenter">
      <h1 class="heroTitle">Near</h1>
      <p class="heroSub">Real people. Near you. Live.</p>
    </section>

    <!-- Vibes -->
    <section class="panel">
      <h2 class="panelTitle">Choose your vibe</h2>

      <div class="vibeGrid" id="vibeGrid">
        <button class="vibe" data-vibe="city" data-img="city.jpg" type="button">City</button>
        <button class="vibe" data-vibe="tech" data-img="tech.jpg" type="button">Tech</button>
        <button class="vibe" data-vibe="nature" data-img="nature.jpg" type="button">Nature</button>
        <button class="vibe" data-vibe="fitness" data-img="fitness.jpg" type="button">Fitness</button>
        <button class="vibe" data-vibe="beach" data-img="beach.jpg" type="button">Beach</button>
        <button class="vibe" data-vibe="food" data-img="food.jpg" type="button">Food</button>
      </div>

      <div class="actionGrid">
        <button class="action" id="btnChooseNear" type="button">Choose<br/>someone<br/>Near</button>
        <button class="action" id="btnWave" type="button">Send a<br/>Wave</button>
        <button class="action" id="btnLiveWaves" type="button">See Live<br/>waves</button>
      </div>

      <div class="microLine" id="microLine">Location is only used when you ask for it.</div>

      <!-- People Near card -->
      <section class="peopleCard">
        <div class="peopleTitle">People<br/>Near</div>

        <div class="peopleBtns">
          <button class="pillBtn" id="btnCreate" type="button">Create</button>
          <button class="pillBtn" id="btnMe" type="button">Me</button>
        </div>

        <div class="peopleNote">Distances shown as a minimum of <b>5 km</b> for privacy.</div>
      </section>
    </section>

    <div class="safeBottom"></div>
  </main>

  <!-- âœ… Single module script (NO second Firebase init anywhere) -->
  <script type="module">
    import { auth } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

    window.addEventListener("DOMContentLoaded", () => {
      // ---------- VIBE UI ----------
      const hero = document.getElementById("hero");
      const vibeGrid = document.getElementById("vibeGrid");
      const statusBadge = document.getElementById("statusBadge");
      const locDot = document.getElementById("locDot");

      if (!hero || !vibeGrid || !statusBadge) {
        console.warn("Near: missing core elements");
        return;
      }

      const vibeButtons = Array.from(vibeGrid.querySelectorAll(".vibe"));

      function setHeroImage(filename){
        hero.style.background =
          `radial-gradient(1200px 800px at 50% 18%, rgba(255,255,255,.10), transparent 55%),
           linear-gradient(180deg, rgba(0,0,0,.30) 0%, rgba(0,0,0,.55) 55%, rgba(0,0,0,.72) 100%),
           url("img/${filename}") center/cover no-repeat`;
      }

      function setActive(btn){
        vibeButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      }

      function getVibe(){
        return localStorage.getItem("near_vibe") || "nature";
      }

      function setVibe(vibe){
        localStorage.setItem("near_vibe", vibe);
        updateStatus();
      }

      function setLocationOn(isOn){
        localStorage.setItem("near_loc_on", isOn ? "1" : "0");
        updateStatus();
      }

      function isLocationOn(){
        return localStorage.getItem("near_loc_on") === "1";
      }

      function updateStatus(){
        const vibe = getVibe();
        const locText = isLocationOn() ? "Location on" : "Location off";
        statusBadge.textContent = `Vibe: ${vibe} â€¢ ${locText}`;
        if (locDot) locDot.style.opacity = isLocationOn() ? "1" : ".25";
      }

      // Wire vibe clicks
      vibeButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          setActive(btn);
          setHeroImage(btn.dataset.img);
          setVibe(btn.dataset.vibe);
        });
      });

      // Restore last vibe
      const saved = getVibe();
      const savedBtn = vibeButtons.find(b => b.dataset.vibe === saved);
      if (savedBtn){
        setActive(savedBtn);
        setHeroImage(savedBtn.dataset.img);
      } else {
        setHeroImage("hero.jpg");
      }
      updateStatus();

      // ---------- AUTH GATING ----------
      let currentUser = null;
      onAuthStateChanged(auth, (u) => {
        currentUser = u;
        // optional: could update UI later (eg show "signed in")
      });

      function goOrLogin(target){
        if (currentUser) window.location.href = target;
        else window.location.href = `login.html?next=${encodeURIComponent(target)}`;
      }

      document.getElementById("btnCreate")?.addEventListener("click", () => goOrLogin("create.html"));
      document.getElementById("btnMe")?.addEventListener("click", () => goOrLogin("profile.html"));
      document.getElementById("btnChooseNear")?.addEventListener("click", () => goOrLogin("near.html"));

      // Placeholder actions
      document.getElementById("btnWave")?.addEventListener("click", () => alert("Soon: send a wave ðŸ‘‹"));
      document.getElementById("btnLiveWaves")?.addEventListener("click", () => alert("Soon: live waves ðŸŒŠ"));

      // Optional: set location flag when theyâ€™ve already enabled it on other pages
      // (near.html can set near_loc_on=1 when user enables location)
      // Here we just reflect stored state.
      // You can also toggle this by clicking the badge if you want later.
    });
  </script>
</body>
</html>
