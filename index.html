<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Near â€” Real people</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="stylesheet" href="styles.css?v=8" />
</head>

<body>
  <!-- HERO -->
  <main id="hero" class="hero">
    <!-- Top badges -->
    <div class="heroTop">
      <div class="brandPill">
        <div class="brandName">N E A R</div>
        <div class="brandTag">nearest &amp; dearest</div>
      </div>

      <div class="statusPill" id="statusPill">
        <span class="dot" id="locDot"></span>
        <span id="statusBadge">Vibe: nature â€¢ Location off</span>
      </div>
    </div>

    <!-- Title -->
    <section class="heroCenter">
      <h1 class="heroTitle">Near</h1>
      <p class="heroSub">Real people. Near you. Live.</p>
    </section>

    <!-- Main panel -->
    <section class="panel">
      <h2 class="panelTitle">Choose your vibe</h2>

      <div class="vibeGrid" id="vibeGrid">
        <button class="vibe" data-vibe="city" data-img="city.jpg">City</button>
        <button class="vibe" data-vibe="tech" data-img="tech.jpg">Tech</button>
        <button class="vibe" data-vibe="nature" data-img="nature.jpg">Nature</button>
        <button class="vibe" data-vibe="fitness" data-img="fitness.jpg">Fitness</button>
        <button class="vibe" data-vibe="beach" data-img="beach.jpg">Beach</button>
        <button class="vibe" data-vibe="food" data-img="food.jpg">Food</button>
      </div>

      <div class="actionGrid">
        <button class="action" id="btnChooseNear">Choose<br>someone<br>Near</button>
        <button class="action" id="btnWave">Send a<br>Wave</button>
        <button class="action" id="btnLiveWaves">See Live<br>waves</button>
      </div>

      <div class="microLine">Location is only used when you ask for it.</div>

      <section class="peopleCard">
        <div class="peopleTitle">People<br>Near</div>

        <div class="peopleBtns">
          <button class="pillBtn" id="btnCreate">Create</button>
          <button class="pillBtn" id="btnMe">Me</button>
        </div>

        <div class="peopleNote">
          Distances shown as a minimum of <b>5 km</b> for privacy.
        </div>
      </section>
    </section>

    <div class="safeBottom"></div>
  </main>

  <!-- SCRIPT -->
  <script type="module">
    import { auth } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

    const hero = document.getElementById("hero");
    const vibeGrid = document.getElementById("vibeGrid");
    const statusBadge = document.getElementById("statusBadge");
    const locDot = document.getElementById("locDot");

    const vibeButtons = [...vibeGrid.querySelectorAll(".vibe")];

    function setHeroImage(filename){
      hero.style.background =
        `radial-gradient(1200px 800px at 50% 18%, rgba(255,255,255,.14), transparent 58%),
         radial-gradient(900px 700px at 50% 78%, rgba(255,220,160,.10), transparent 65%),
         linear-gradient(180deg,
           rgba(0,0,0,.08) 0%,
           rgba(0,0,0,.14) 55%,
           rgba(0,0,0,.20) 100%
         ),
         url("img/${filename}") center/cover no-repeat`;

      hero.style.filter = "saturate(1.06) contrast(1.04) brightness(1.06)";
    }

    function setActive(btn){
      vibeButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    function getVibe(){
      return localStorage.getItem("near_vibe") || "nature";
    }

    function setVibe(vibe){
      localStorage.setItem("near_vibe", vibe);
      updateStatus();
    }

    function isLocationOn(){
      return localStorage.getItem("near_loc_on") === "1";
    }

    function updateStatus(){
      const vibe = getVibe();
      const locText = isLocationOn() ? "Location on" : "Location off";
      statusBadge.textContent = `Vibe: ${vibe} â€¢ ${locText}`;
      locDot.style.opacity = isLocationOn() ? "1" : ".25";
    }

    vibeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        setActive(btn);
        setHeroImage(btn.dataset.img);
        setVibe(btn.dataset.vibe);
      });
    });

    const savedVibe = getVibe();
    const savedBtn = vibeButtons.find(b => b.dataset.vibe === savedVibe);
    if (savedBtn){
      setActive(savedBtn);
      setHeroImage(savedBtn.dataset.img);
    } else {
      setHeroImage("hero.jpg");
    }
    updateStatus();

    let currentUser = null;
    onAuthStateChanged(auth, (u) => currentUser = u);

    function goOrLogin(target){
      if (currentUser) window.location.href = target;
      else window.location.href = `login.html?next=${encodeURIComponent(target)}`;
    }

    document.getElementById("btnCreate").onclick = () => goOrLogin("create.html");
    document.getElementById("btnMe").onclick = () => goOrLogin("profile.html");
    document.getElementById("btnChooseNear").onclick = () => goOrLogin("near.html");

    document.getElementById("btnWave").onclick = () => alert("Soon: send a wave ðŸ‘‹");
    document.getElementById("btnLiveWaves").onclick = () => alert("Soon: live waves ðŸŒŠ");
  </script>
</body>
</html>
